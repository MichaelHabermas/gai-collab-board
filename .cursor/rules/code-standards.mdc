---
description: Code standards for data-testid, non-null assertion, and control flow braces
alwaysApply: true
---

# Code Standards

## Unique data-testid

- **Every `data-testid` value in the project must be unique.** Do not reuse the same value on different elements.
- Use distinct identifiers per element (e.g. per-item suffixes or IDs) so test and E2E selectors target exactly one node.

## No non-null assertion

- **Do not use TypeScript's non-null assertion operator (`!`).** Use optional chaining (`?.`), explicit null/undefined checks, or type guards so types narrow safely.

```typescript
// ✅ CORRECT
const x = value?.property;
if (value !== null) {
  const x = value.property;
}

// ❌ WRONG
const x = value!.property;
```

## Braces for if / else

- **Always use block statements with curly braces for `if`, `else if`, and `else`.** Do not omit braces for single-statement branches.

```typescript
// ✅ CORRECT
if (condition) {
  return result;
}
if (condition) {
  doSomething();
} else {
  doOther();
}

// ❌ WRONG
if (condition) return result;
if (condition) doSomething();
else doOther();
```

## Prefer falsy check over explicit null/undefined

- **Prefer `!expr` over `expr === null` or `expr === undefined` in conditions** when the intent is a simple nullish check. Prefer `expr` over `expr !== null` and `expr !== undefined` for the positive case. Enforced by `local/prefer-falsy-over-explicit-nullish` (warn).

## Prefer destructuring

- **Prefer object destructuring** when declaring variables or assigning from an object (e.g. `const { a, b } = obj` instead of `const a = obj.a; const b = obj.b`). Enforced by `prefer-destructuring` (warn).

## Minimize unnecessary useEffect

- **Avoid `useEffect` for derived state.** Compute during render or use `useMemo` instead of syncing state in an effect.
- **Avoid `useEffect` for event handling.** Handle user actions in event handlers, not via effects that react to state.
- **Avoid `useEffect` for one-time setup when possible.** Use `useState(initializer)` or `useRef` for init that runs once.
- **Use `useEffect` only for:** subscriptions (Firebase, WebSocket, `addEventListener`), cleanup (unsubscribe, clear timers/RAF), or syncing with external systems (DOM, storage, callbacks to parent).
- **Files with 3+ effects** should trigger extraction of related effects into custom hooks with a single responsibility.
